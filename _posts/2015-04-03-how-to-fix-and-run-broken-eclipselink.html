---
layout: post
title: How to fix and run the broken EclipseLink Tutorial example (JSF and JPA)
date: '2015-04-03T14:23:00.000+02:00'
author: Gerald O'Sullivan
tags:
- JSF
- Tomcat 8
- EclipseLink
- JPA
- PostgreSQL
- Eclipse
modified_time: '2015-09-12T05:38:00.672+02:00'
thumbnail: http://4.bp.blogspot.com/-VZ-HU2CfYjo/VR7dvaFecPI/AAAAAAAABDM/C6XX49dK1DY/s72-c/girlBlowingPartyThings.jpg
blogger_id: tag:blogger.com,1999:blog-5063526183496324043.post-833994477150060727
blogger_orig_url: https://surfacedetail.blogspot.com/2015/04/how-to-fix-and-run-broken-eclipselink.html
---

<h3>The EclipseLink Tutorial</h3>The EclipseLink implementation of JPA has a <a href="https://wiki.eclipse.org/EclipseLink/Examples/JPA/JSF_Tutorial">tutorial</a> for running it with JSF on the Tomcat servlet container, instead of a full-blown Java EE  Application Server.<br /><br />The tutorial mentions two source code downloads, both of which were missing from the page, but I managed to find a directory of the <a href="http://www.oracle.com/technetwork/middleware/ias/order-jsf-jpa-tutorial-130794.zip">stubbed tutorial source</a> that you can use as a starting point as you follow the EclipseLink tutorial, as well as the <a href="http://www.oracle.com/technetwork/topics/order-jsf-jpa-example-128127.zip">code for the completed version</a> of the application.<br /><br />Unfortunately, the tutorial is out-of-date, the source code has  several errors, and the application itself is very primitive, but you may  be curious enough to want to try it out anyway. This is how to get the completed application  running on Tomcat against a PostgreSQL database using the Eclipse IDE. <br /><br />The application is a very simple Order application with this object model:<br /><br /><div class="separator" style="clear: both; text-align: center;"></div><div style="margin-left: 1em; margin-right: 1em;"><img alt="Tutorial Object Model" height="222" src="https://wiki.eclipse.org/images/3/3e/Jpa_jsf_tutorial_model.gif" width="320" /></div><h3>&nbsp;</h3><h3>Set up the environment </h3>Download and unzip the <a href="http://www.oracle.com/technetwork/topics/order-jsf-jpa-example-128127.zip">code for the completed version</a> of the application. It is an Ant project that is not structured like an Eclipse Dynamic Web Project, so just create a simple Java project, called here <b>EclipseLinkTutorial</b>, and import the source code order-jsf-jpa-example-128127 from your download folder. <br /><br />Tomcat is a servlet container, not a Java EE application server like WildFly (formerly known as JBoss Application Server), so you must manually copy the PostgreSQL database driver as well as the EclipseLink and Java Persistence JARs to <i>EclipseLinkTutorial/lib</i>. I got mine from my Maven repo because I had used them in another project. They are:<br /><ul><li>postgresql-9.3-1102-jdbc41.jar&nbsp;</li><li>eclipselink-2.6.0-M3.jar&nbsp;</li><li>javax.persistence-2.1.0.jar&nbsp;</li></ul>Don't forget to refresh the project so that Eclipse can see the jars. Note that it is not worth the bother to Mavenise the project to add these dependencies. See <a href="http://stackoverflow.com/questions/17237679/migrating-complex-project-from-ant-to-maven-how-to-handle-unusual-folder-struc">this StackOverflow discussion</a> about Ant and Maven.<br /><br /><h3>Configure the database</h3>Switch to your database server, fire up psql as postgres and create a login role (a.k.a. the user) and database:<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: blue;">CREATE</span> <span style="color: blue;">ROLE</span> eclipselinktutorial LOGIN SUPERUSER <span style="color: blue;">CREATEDB</span>;<br /><span style="color: blue;">ALTER</span> <span style="color: blue;">ROLE</span> eclipselinktutorial PASSWORD <span style="color: #a31515;">'eclipse'</span>;<br /><span style="color: blue;">CREATE</span> <span style="color: blue;">DATABASE</span> eclipselinktutorial <span style="color: blue;">WITH</span> <span style="color: blue;">ENCODING</span>=<span style="color: #a31515;">'UTF8'</span> <span style="color: blue;">OWNER</span>=eclipselinktutorial;<br /></pre></div><br />Test the connection from Eclipse, where 'your-DB-server' is either the hostname of your database server or 'localhost' if you have installed PostgreSQL on your workstation:<br /><br />→ Window → Open perspective → Other... → Database development<br />Right-click Database Connections → New... →  Connection<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Profile Types: PostgreSQL<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Name:  eclipselinktutorial<br />→ Next<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Database:  eclipselinktutorial<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;URL:  jdbc:postgresql://your-DB-server:5432/eclipselinktutorial<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User name: eclipselinktutorial<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Password: eclipse<br /><br />Check the 'Save the password' box then click on Test Connection. It should say "Ping succeeded". Click on Finish.<br /><br /><h3>Configure the JPA persistence properties</h3>Edit the persistence file <i>EclipseLinkExample\persistence-unit\src\META-INF\persistence.xml</i> and set the following properties to match the database configuration (don't forget to change 'your-DB-server'):<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;">&lt;persistence xmlns=<span style="color: #a31515;">"http://java.sun.com/xml/ns/persistence"</span><br /> xmlns:xsi=<span style="color: #a31515;">"http://www.w3.org/2001/XMLSchema-instance"</span><br /> xsi:schemaLocation=<span style="color: #a31515;">"http://java.sun.com/xml/ns/persistence persistence_1_0.xsd"</span><br /> version=<span style="color: #a31515;">"1.0"</span>&gt;<br /> &lt;persistence-unit name=<span style="color: #a31515;">"default"</span> transaction-type=<span style="color: #a31515;">"RESOURCE_LOCAL"</span>&gt;<br />  &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;<br />  &lt;class&gt;oracle.toplink.jpa.example.inventory.model.Inventory&lt;/class&gt;<br />  &lt;class&gt;oracle.toplink.jpa.example.inventory.model.Order&lt;/class&gt;<br />  &lt;class&gt;oracle.toplink.jpa.example.inventory.model.Item&lt;/class&gt;<br />  &lt;properties&gt;<br />   &lt;property name=<span style="color: #a31515;">"javax.persistence.jdbc.logging.level"</span> value=<span style="color: #a31515;">"FINE"</span> /&gt;<br />   &lt;property name=<span style="color: #a31515;">"javax.persistence.jdbc.driver"</span> value=<span style="color: #a31515;">"org.postgresql.Driver"</span> /&gt;<br />   &lt;property name=<span style="color: #a31515;">"javax.persistence.jdbc.url"</span><br />    value=<span style="color: #a31515;">"jdbc:postgresql://your-DB-server:5432/eclipselinktutorial"</span> /&gt;<br />   &lt;property name=<span style="color: #a31515;">"javax.persistence.jdbc.password"</span> value=<span style="color: #a31515;">"eclipse"</span> /&gt;<br />   &lt;property name=<span style="color: #a31515;">"javax.persistence.jdbc.user"</span> value=<span style="color: #a31515;">"eclipselinktutorial"</span> /&gt;<br />  &lt;/properties&gt;<br /> &lt;/persistence-unit&gt;<br />&lt;/persistence&gt;<br /></pre></div><br /><h3>Fix the project</h3>The downloaded source code directory from the Oracle site has errors that cause the Ant build.xml script to fail.<br /><br />It is missing directories that the Ant build.xml script expects, so create the following folders:<br /><ul><li>persistence-unit/classes&nbsp;</li><li>persistence-unit/deploy&nbsp;</li><li>extras/classes&nbsp;</li><li>web-application/classes&nbsp;</li><li>web-application/deploy&nbsp;</li></ul>The entities in <i>EclipseLinkTutorial/persistence-unit/src</i> have a property called <i>version</i> which has an annotation of <a href="http://stackoverflow.com/questions/2572566/java-jpa-version-annotation">@Version</a>. In the entity <i>Item</i>, the setVersion() method is annotated, not the field itself, which will cause this error:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mapping metadata cannot be applied to properties/methods<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that take arguments.<br /><br />Annote the field <i>version</i> in the entity <i>Item</i> with @Version and remove the getter and setter to fix this.<br /><br />The entity <i>Item</i> also has the annotations @Id and @GeneratedValue on the method getSKU(), not the field SKU itself. Move them to the correct place:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @Id<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @GeneratedValue<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected long SKU;<br /><br />There are two named queries in Order that will generate build errors because 'SKU' is incorrectly written 'sKU'. Edit Order and make sure they both read 'SKU". <br /><br />In the <i>build.xml</i> file, include this line to each of the three javac directives to <a href="http://stackoverflow.com/questions/5103384/ant-warning-includeantruntime-was-not-set">suppress warnings</a> when the Ant build runs:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;includeantruntime="false"<br /><br />Lastly, edit the <i>DDLGenerator</i> class in <i>extras/src</i> to replace "toplink.ddl-generation" with "eclipselink.ddl-generation" so that when the generate-tables target is executed, the correct property is set to instruct the Entity Manager to recreate the tables. <br /><br /><h3>Generate the database tables</h3>Now you are ready to run the Ant builds:<br /><br />Right-click EclipseLinkTutorial/build.xml → Run As → Ant Build...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Deselect the default target to be executed and select <b>generate-tables</b><br />→ Run<br /><br />If it runs very quietly with no errors, you have succeeded. Yay.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-VZ-HU2CfYjo/VR7dvaFecPI/AAAAAAAABDM/C6XX49dK1DY/s1600/girlBlowingPartyThings.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://4.bp.blogspot.com/-VZ-HU2CfYjo/VR7dvaFecPI/AAAAAAAABDM/C6XX49dK1DY/s1600/girlBlowingPartyThings.jpg" width="240" /></a></div><br /><br />Now create the data by executing the Ant target <b>populate-data</b>.<br /><br /><h3>Generate the WAR</h3>The last step is to compile and package the WAR for deployment to Tomcat:<br /><br />Right-click EclipseLinkTutorial/build.xml → Run As → Ant Build...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Select the default target <b>all</b> and check that the other targets are deselected<br />→ Run<br /><br />It will create <i>EclipseLinkTutorial/web-application/deploy/jpa-example.war</i> which you can deploy to your instance of Tomcat.<br /><br />Of course, getting the complete application up and running is one thing. Understanding JPA is another, so download the stubbed code, roll up your sleeves and work through the tutorial.