---
layout: post
title: Tomcat 8 on Debian Jessie with PSI Probe and OpenNMS to monitor performance
  (Part 1)
date: '2015-06-30T11:18:00.001+02:00'
author: Gerald O'Sullivan
tags:
- Tomcat 8
- PSI Probe
- Debian Jessie
- OpenNMS
modified_time: '2015-07-12T17:54:37.778+02:00'
thumbnail: http://3.bp.blogspot.com/-0SjhfMo7Svc/VZGBzjE0-EI/AAAAAAAABGE/jMF6M3-Ntxo/s72-c/Flexible-Cat-Picture-60.jpg
blogger_id: tag:blogger.com,1999:blog-5063526183496324043.post-6327081439208692781
blogger_orig_url: https://surfacedetail.blogspot.com/2015/06/tomcat-8-on-debian-jessie-with-psi.html
---

This is the first of three posts about the latest version of Apache Tomcat, still the most <a href="https://plumbr.eu/blog/java/most-popular-application-servers-in-2014">widely used</a> application server, on Debian Jessie, with PSI Probe to manage it and OpenNMS to monitor its up-time.<br /><br /><h3>What's new in Tomcat 8?</h3>Debian Jessie was released with Apache Tomcat 8, which provides the following:<br /><ul><li>Java Servlet 3.1, an incremental release of the servlet specification that includes non-blocking I/O to improve scaleability and an HTTP protocol upgrade mechanism that allows the client and the server to negotiate a transition from HTTP 1.1 to some other new chosen protocol;</li><li>JavaServer Pages 2.3, a maintenance release to provide support for Expression Language (EL) 3.0 and to use the functionality of the Servlet 3.1 API; </li><li>Java Unified Expression Language (EL) 3.0, which allows EL to run in a standalone mode outside of servlets or JSPs, plus lambda expressions and other Java 8 goodies;</li><li>WebSocket 1.1, which allows full duplex communications over TCP so that bidirectional data can flow at the same time;</li><li>A single, common resources implementation that <span style="line-height: 1.3em;">merges Aliases, VirtualLoader,  VirtualDirContext, JAR resources and external repositories into a single  framework rather than a separate one for each feature;</span></li><li>and Java EE 7 as a minimum pre-requisite, preferably Java EE 8, which has better support for HTML5, WebSockets, JSON and RESTful services.</li></ul><br /><ul></ul><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-0SjhfMo7Svc/VZGBzjE0-EI/AAAAAAAABGE/jMF6M3-Ntxo/s1600/Flexible-Cat-Picture-60.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://3.bp.blogspot.com/-0SjhfMo7Svc/VZGBzjE0-EI/AAAAAAAABGE/jMF6M3-Ntxo/s320/Flexible-Cat-Picture-60.jpg" width="287" /></a></div><br />Tomcat 8 is more flexible and better equipped to support web services than its predecessor, so let's proceed to the upgrade.<br /><br /><h3>Installing Tomcat 8</h3>Installing Tomcat 8 on Debian Jessie is dead simple. First, SSH to your web server (called 'my-server-IP' here) as root, and&nbsp; execute 'java -version' to check that OpenJDK 7 is installed as a minimum:<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;"># java -version<br />java version <span style="background-color: #e0e0ff;">"1.7.0_79"</span><br />OpenJDK Runtime Environment <span style="color: #333333;">(</span>IcedTea 2.5.5<span style="color: #333333;">)</span> <span style="color: #333333;">(</span>7u79-2.5.5-1~deb8u1<span style="color: #333333;">)</span><br />OpenJDK 64-Bit Server VM <span style="color: #333333;">(</span>build 24.79-b02, mixed mode<span style="color: #333333;">)</span><br /></pre></div><br />If you don't see OpenJDK 7, you will have to install it and set it to be the default JVM:<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;"># apt-get install openjdk-7-jdk openjdk-7-demo openjdk-7-source<br /># update-alternatives --config java<br /></pre></div><br />If you prefer, you can install OpenJDK 8 from the jessie-backports repository instead of OpenJDK 7, but it makes no difference to Tomcat 8.<br /><br />Now install Tomcat 8:<br /><!-- HTML generated using hilite.me --> <br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;"># apt-get install tomcat8 tomcat8-admin tomcat8-docs tomcat8-examples tomcat8-user&nbsp;</pre></div><br />If all goes well, the service should start automatically and you should be able to browse to <b>http://my-server-IP:8080</b> to see the default page:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-MElZoc-Hcrs/VZJC1fj58vI/AAAAAAAABGc/lawgjQOPxaI/s1600/TomcatItWorks.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="238" src="http://2.bp.blogspot.com/-MElZoc-Hcrs/VZJC1fj58vI/AAAAAAAABGc/lawgjQOPxaI/s640/TomcatItWorks.png" width="570" /></a></div><h3></h3><h3></h3><h3>Configuring Tomcat 8</h3>Once you have installed Tomcat 8, you must enable the manager webapp, and you may optionally tune the JVM memory settings.<br /><br />Edit /etc/tomcat8/tomcat-users.xml to include a manager (called 'my-user' here), with the <a href="https://tomcat.apache.org/tomcat-7.0-doc/manager-howto.html#Configuring_Manager_Application_Access">appropriate roles</a> to use the web console manager:<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;"># vi /etc/tomcat8/tomcat-users.xml<br />&lt;tomcat-users&gt;<br />   &lt;role <span style="color: #003366;">rolename</span><span style="color: #333333;">=</span><span style="background-color: #e0e0ff;">"manager-gui"</span>/&gt;<br />   &lt;role <span style="color: #003366;">rolename</span><span style="color: #333333;">=</span><span style="background-color: #e0e0ff;">"admin-gui"</span>/&gt;<br />   &lt;user <span style="color: #003366;">username</span><span style="color: #333333;">=</span><span style="background-color: #e0e0ff;">"my-user"</span> <span style="color: #003366;">password</span><span style="color: #333333;">=</span><span style="background-color: #e0e0ff;">"my-user-password"</span> <span style="color: #003366;">roles</span><span style="color: #333333;">=</span><span style="background-color: #e0e0ff;">"manager-gui,admin-gui"</span>/&gt;<br />&lt;/tomcat-users&gt;<br /></pre></div><br />The manager-gui role has the highest privileges, allowing you to use the web console manager to deploy and undeploy apps, view stats, generate leak detection diagnostics, expire sessions, and so on. The admin-gui role is needed to access the virtual host manager.<br /><br />Optionally edit the default Tomcat 8 configuration to make sure that JAVA_HOME is correctly set and to <a href="http://www.tomcatexpert.com/blog/2011/11/22/performance-tuning-jvm-running-tomcat">tune the performance of the JVM</a>:<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;"># vi /etc/default/tomcat8<br /><span style="color: #003366;">JAVA_HOME</span><span style="color: #333333;">=</span>/usr/lib/jvm/java-7-openjdk-amd64<br /><span style="color: #003366;">JAVA_OPTS</span><span style="color: #333333;">=</span><span style="background-color: #e0e0ff;">"-Djava.awt.headless=true -Xms2048m -Xmx2048m -XX:+UseConcMarkSweepGC"</span><br /></pre></div><br />Now restart Tomcat 8, using the systemd way of managing services:<br /><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;"># systemctl restart tomcat8<br /></pre></div><br />and browse to  <b>http://my-server-IP:8080/manager</b>.<br /><br />Login with the username you created in tomcat-users.xml to access the <a href="https://tomcat.apache.org/tomcat-7.0-doc/html-manager-howto.html">Web Application Manager</a>, an eye-watering horror of mustard and green that we will quickly replace with PSI Probe in <a href="http://surfacedetail.blogspot.com/2015/07/tomcat-8-on-debian-jessie-with-psi.html">Part 2</a> of this series, a much better-looking web console manager with a raft of extra functionality.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-w6ZUfizFu74/VZJibm6ILjI/AAAAAAAABGs/LO0mc5MbSO8/s1600/TomcatWebManager.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="296" src="http://2.bp.blogspot.com/-w6ZUfizFu74/VZJibm6ILjI/AAAAAAAABGs/LO0mc5MbSO8/s640/TomcatWebManager.png" width="640" /></a></div><br /><h3>Location of Tomcat 8 directories on Debian</h3>Note that the Debian package maintainers have a standard <a href="https://www.debian.org/doc/debian-policy/">Debian way</a> of doing things so the Tomcat 8 directories may not be where you expect them to be. The relevant locations are:<br /><br /><b>/etc/default: </b>the initial default settings such as the Tomcat user ID, JAVA_HOME, JVM settings, and so on, are in the file 'tomcat8'. <br /><br /><b>/etc/tomcat8:</b> the server configuration files are here, including context.xml, server.xml and tomcat-users.xml.<br /><br /><b>/etc/logrotate.d: </b>the log settings for catalina.out are in the file 'tomcat8'.<br /><br /><b>/usr/share/tomcat8:</b> this is $CATALINA_HOME, the root of the Tomcat installation, also known as $TOMCAT_HOME. It has startup, shutdown, and other scripts, as well as the Tomcat JARs in $CATALINA_HOME/lib (the original project to develop the servlet engine was called <a href="http://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=17&amp;cad=rja&amp;uact=8&amp;ved=0CJQBEJoTMBA&amp;url=http%3A%2F%2Fen.wikipedia.org%2Fwiki%2FSanta_Catalina_Island%2C_California&amp;ei=sVaSVbmSLYvsUom7nKgG&amp;usg=AFQjCNFiG8iD5LxVRdKIknpFEgUsRTdAXA&amp;sig2=h9tL3q9f33n-g6L_ERP6Jw&amp;bvm=bv.96783405,d.d24">Catalina</a>).<br /><br /><b>/var/lib/tomcat8: </b>this is $CATALINA_BASE, also known as $TOMCAT_BASE, which holds instance-specific directories for web applications, with the code in $CATALINA_BASE/webapps.<br /><br /><b>/var/log/tomcat8:</b> all the log files are stored here.<br /><br />Now stay tuned for the installation of PSI Probe in <a href="http://surfacedetail.blogspot.com/2015/07/tomcat-8-on-debian-jessie-with-psi.html">Part 2</a>. 