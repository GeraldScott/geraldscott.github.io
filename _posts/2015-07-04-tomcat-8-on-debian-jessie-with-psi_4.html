---
layout: post
title: Tomcat 8 on Debian Jessie with PSI Probe and OpenNMS to monitor performance
  (Part 3)
date: '2015-07-04T10:41:00.000+02:00'
author: Gerald O'Sullivan
tags:
- Tomcat 8
- PSI Probe
- Debian Jessie
- OpenNMS
modified_time: '2015-07-12T17:40:27.442+02:00'
thumbnail: http://1.bp.blogspot.com/-7vvLr9zQQ0M/VZd2G2PXtmI/AAAAAAAABIk/hPycWpO2kZY/s72-c/soda-report-cropped.png
blogger_id: tag:blogger.com,1999:blog-5063526183496324043.post-283959002969113633
blogger_orig_url: https://surfacedetail.blogspot.com/2015/07/tomcat-8-on-debian-jessie-with-psi_4.html
---

We looked at Tomcat 8 in <a href="http://surfacedetail.blogspot.com/2015/06/tomcat-8-on-debian-jessie-with-psi.html">Part 1</a> of this series and at PSI Probe as a replacement for the default Tomcat Manager application in <a href="http://surfacedetail.blogspot.com/2015/07/tomcat-8-on-debian-jessie-with-psi.html">Part 2</a>.<br /><br />Now PSI Probe is great for managing Tomcat and its applications, but it does not actively generate alerts if Tomcat is in difficulty, or any other part of the application stack for that matter, so this is where OpenNMS plugs the gap.<br /><br /><h3> Network Management with OpenNMS</h3>If you cut your teeth on the mainframes of the recent past, you will be familiar with network management tools like HP OpenView and IBM Tivoli. These tools are famous for their complexity and cost, so alternatives like Nagios (subsequently forked as Icinga) and OpenNMS emerged as open source alternatives.<br /><br />OpenNMS is a Java-based, agentless monitoring tool that uses SNMP to monitor devices on the network. It was designed to manage service level agreements, so in addition to fault reporting (with trouble ticketing), it has a large number of service monitors to report against service thresholds.<br /><br />If your device is SNMP-enabled, OpenNMS will auto-discover the device, add it as another node to your network topology and start monitoring it immediately, including <a href="http://www.openvnd.org/">vending machines</a>.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-7vvLr9zQQ0M/VZd2G2PXtmI/AAAAAAAABIk/hPycWpO2kZY/s1600/soda-report-cropped.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="210" src="http://1.bp.blogspot.com/-7vvLr9zQQ0M/VZd2G2PXtmI/AAAAAAAABIk/hPycWpO2kZY/s400/soda-report-cropped.png" width="400" /></a></div><br /><h3>OpenNMS Installation</h3>The instructions for installing on Debian are <a href="http://www.opennms.org/wiki/Installation:Debian">here</a>, but I will deviate slightly because I want to install OpenNMS on a pre-existing installation of Postgresql 9.4 on another server.<br /><br /><h4>Create a database for OpenNMS</h4>Login to the database server (called 'my-database-ip' here) and create an empty database called 'opennms', owned by 'opennms':<br /><pre class="prettyprint"># su - postgres<br /># psql -c "CREATE USER opennms WITH LOGIN ENCRYPTED PASSWORD 'my-opennms-password';"<br /># psql -c "CREATE DATABASE opennms WITH OWNER=opennms ENCODING 'UNICODE';"<br /></pre><h4>Install OpenNMS </h4>On the server that you intend to run OpenNMS (called 'my-server-ip' here), add the OpenNMS repository to the APT sources list, add GPG key to verify the integrity of the package, update APT and install OpenNMS: <br /><pre class="prettyprint"># vi /etc/apt/sources.list.d/opennms.list<br />   deb http://debian.opennms.org stable main<br /># wget -O - http://debian.opennms.org/OPENNMS-GPG-KEY | apt-key add -<br /># apt-get update<br /># apt-get install opennms<br /></pre>Once the installation is complete, the database must be initialised, but before you run the scripts, you must give OpenNMS access to the database that you created by configuring the datasources: <br /><pre class="prettyprint"># vi /etc/opennms/opennms-datasources.xml<br />  &lt;jdbc-data-source class-name="org.postgresql.Driver" database-name="opennms" name="opennms" password="my-opennms-password" url="jdbc:postgresql://my-database-ip:5432/opennms" user-name="opennms"&gt;<br />  &lt;jdbc-data-source class-name="org.postgresql.Driver" database-name="template1" name="opennms-admin" password="my-postgres-password" url="jdbc:postgresql://my-database-ip:5432/template1" user-name="postgres"&gt;<br /></pre>Now configure the JRE for OpenNMS and then run the installation: <br /><pre class="prettyprint"># /usr/share/opennms/bin/runjava -s<br /># /usr/share/opennms/bin/install -dis<br /></pre>Install the <b>iplike</b> package to optimize lookups based on IP addresses, and then start the service: <br /><pre class="prettyprint"># /usr/sbin/install_iplike.sh<br /># systemctl start opennms<br /></pre>If all is well, you should be able to browse to your instance of OpenNMS at <b>http://my-server-ip:8980</b> and log in with admin/admin.<br /><br />You can check that all the daemons are running with: <br /><pre class="prettyprint"># opennms -v status<br /></pre>Note that OpenNMS uses <a href="http://www.opennms.org/wiki/Ports_used_by_OpenNMS">two ports</a> that you should be aware of: an httpAdaptor at 8181 and the application itself running on Jetty at 8980.<br /><br />Once you have completed the install, you may want to comment out the OpenNMS repository that you added to APT, to prevent unsolicited updates of OpenNMS, particularly in a Production environment.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-hskaK7zLZlA/VZkmcjN6Z0I/AAAAAAAABJQ/M4EKeAuMJvo/s1600/soda-machine-cropped.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="228" src="http://3.bp.blogspot.com/-hskaK7zLZlA/VZkmcjN6Z0I/AAAAAAAABJQ/M4EKeAuMJvo/s320/soda-machine-cropped.png" width="320" /></a></div><br /><h3>  Discover nodes</h3>By default OpenNMS monitors no network nodes at all, so the very first thing to do is to register the nodes to be monitored.<br /><br />You can do a range scan but that will register every device in the range, whether you want to manage it or not, so rather register the nodes explicitly.<br /><br />There are a number of ways to do this, but since you already have the IP address, the easiest is to register it directly:<br /><br /><span style="font-size: small;"><b>Admin &gt; Configure OpenNMS &gt; Configure Discovery &gt; Specifics &gt; Add new</b></span><br /><br />This will open a pop-up where you enter the IP address of the node, in this case it would be <b>my-server-ip</b>.<br /><br />Click on 'Add", then when the pop-up closes, click on 'Save and Restart Discovery'.<br /><br />Wait a moment while the discovery daemon runs, then list the node that you registered:<br /><br /><span style="font-size: small;"><b>Info &gt; Nodes</b></span> <br /><br />Now that the node has been discovered, I will show you how to monitor the JVM using JMX and SNMP in a later post. In the meantime, play around with the Service Level Management functionality in OpenNMS that comes out of the box.<br /><br />